<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>nest-typecript-mongodb-complexe documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">nest-typecript-mongodb-complexe documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content controller">
                   <div class="content-data">





<ol class="breadcrumb">
  <li class="breadcrumb-item">Controllers</li>
  <li class="breadcrumb-item" >AuthController</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/modules/auth/auth.controller.ts</code>
        </p>

            <p class="comment">
                <h3>Prefix</h3>
            </p>
            <p class="comment">
                <code>auth</code>
            </p>






            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier">Async</span>
                                <a href="#confirm" >confirm</a>
                            </li>
                            <li>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier">Async</span>
                                <a href="#forgotPassword" >forgotPassword</a>
                            </li>
                            <li>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier">Async</span>
                                <a href="#login" >login</a>
                            </li>
                            <li>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier">Async</span>
                                <a href="#refreshToken" >refreshToken</a>
                            </li>
                            <li>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier">Async</span>
                                <a href="#registerClient" >registerClient</a>
                            </li>
                            <li>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier">Async</span>
                                <a href="#registerOrganization" >registerOrganization</a>
                            </li>
                            <li>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier"></span>
                                    <span class="modifier">Async</span>
                                <a href="#resetPassword" >resetPassword</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="confirm"></a>
                    <span class="name">
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier">Async</span>
                        <span ><b>confirm</b></span>
                        <a href="#confirm"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>confirm(token: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, res: Response, req: Request, ip: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Decorators : </b>
                    <br />
                    <code>@ApiOperation({summary: &#x27;Confirm user account&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;The user account has been successfully verified.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Bad Request - Invalid token.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Not Found - User not found.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Gone - Token expired.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Internal Server Error - Something went wrong.&#x27;})<br />@Get(&#x27;confirm/:token&#x27;)<br /></code>
                </td>
            </tr>

                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="549"
                                    class="link-to-prism">src/modules/auth/auth.controller.ts:549</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Confirm user account</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>token</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: string</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: Response</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>req</td>
                                            <td>
                                                        <code>Request</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>ip</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>: Response</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="forgotPassword"></a>
                    <span class="name">
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier">Async</span>
                        <span ><b>forgotPassword</b></span>
                        <a href="#forgotPassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>forgotPassword(forgotPasswordDto: <a href="../classes/ForgotPasswordDto.html" target="_self">ForgotPasswordDto</a>, res: Response, req: Request, ip: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Decorators : </b>
                    <br />
                    <code>@ApiOperation({summary: &#x27;Forgot Password&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Password reset link sent to the user&#x27;s email.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Bad Request - Invalid email provided.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Not Found - User with this email does not exist.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Internal Server Error - Something went wrong.&#x27;})<br />@Post(&#x27;forgot-password&#x27;)<br /></code>
                </td>
            </tr>

                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="971"
                                    class="link-to-prism">src/modules/auth/auth.controller.ts:971</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Forgot Password</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>forgotPasswordDto</td>
                                            <td>
                                                            <code><a href="../classes/ForgotPasswordDto.html" target="_self" >ForgotPasswordDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: ForgotPasswordDto</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: Response</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>req</td>
                                            <td>
                                                        <code>Request</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>ip</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: string</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>: Response</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="login"></a>
                    <span class="name">
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier">Async</span>
                        <span ><b>login</b></span>
                        <a href="#login"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>login(loginUserDto: <a href="../classes/LoginUserDto.html" target="_self">LoginUserDto</a>, res: Response, req: Request, ip: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Decorators : </b>
                    <br />
                    <code>@ApiOperation({summary: &#x27;Sign in an user&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;The user has been successfully authenticated.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Bad Request - Invalid input data.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Not Found - User not found.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Internal Server Error - Something went wrong.&#x27;})<br />@Post(&#x27;login&#x27;)<br /></code>
                </td>
            </tr>

                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="371"
                                    class="link-to-prism">src/modules/auth/auth.controller.ts:371</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Sign in an user</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>loginUserDto</td>
                                            <td>
                                                            <code><a href="../classes/LoginUserDto.html" target="_self" >LoginUserDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: LoginUserDto</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: Response</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>req</td>
                                            <td>
                                                        <code>Request</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>ip</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>: Response</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="refreshToken"></a>
                    <span class="name">
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier">Async</span>
                        <span ><b>refreshToken</b></span>
                        <a href="#refreshToken"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>refreshToken(refreshTokenDto: <a href="../classes/RefreshTokenDto.html" target="_self">RefreshTokenDto</a>, res: Response)</code>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Decorators : </b>
                    <br />
                    <code>@ApiOperation({summary: &#x27;Regenerate access token using refresh token&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Access token successfully regenerated.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Bad Request - Invalid refresh token.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Unauthorized - Refresh token is expired or invalid.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Internal Server Error - Something went wrong.&#x27;})<br />@Post(&#x27;refresh-token&#x27;)<br /></code>
                </td>
            </tr>

                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="718"
                                    class="link-to-prism">src/modules/auth/auth.controller.ts:718</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Regenerate access token using refresh token</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>refreshTokenDto</td>
                                            <td>
                                                            <code><a href="../classes/RefreshTokenDto.html" target="_self" >RefreshTokenDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: RefreshTokenDto</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: Response</p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>: Response</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="registerClient"></a>
                    <span class="name">
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier">Async</span>
                        <span ><b>registerClient</b></span>
                        <a href="#registerClient"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>registerClient(createAuthClientDto: <a href="../classes/CreateAuthClientDto.html" target="_self">CreateAuthClientDto</a>, res: Response, req: Request, ip: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Decorators : </b>
                    <br />
                    <code>@ApiOperation({summary: &#x27;Register a new client&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;The client has been successfully registered.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Bad Request - Invalid input data.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Conflict - Email or phone number already exists.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Unprocessable Entity - Phone number is required.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Internal Server Error - Something went wrong.&#x27;})<br />@Post(&#x27;register/client&#x27;)<br /></code>
                </td>
            </tr>

                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="77"
                                    class="link-to-prism">src/modules/auth/auth.controller.ts:77</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Register a new client</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>createAuthClientDto</td>
                                            <td>
                                                            <code><a href="../classes/CreateAuthClientDto.html" target="_self" >CreateAuthClientDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: CreateAuthClientDto</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: Response</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>req</td>
                                            <td>
                                                        <code>Request</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>ip</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>: Response</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="registerOrganization"></a>
                    <span class="name">
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier">Async</span>
                        <span ><b>registerOrganization</b></span>
                        <a href="#registerOrganization"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>registerOrganization(createAuthOrganizationDto: <a href="../classes/CreateAuthOrganizationDto.html" target="_self">CreateAuthOrganizationDto</a>, res: Response, req: Request, ip: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Decorators : </b>
                    <br />
                    <code>@ApiOperation({summary: &#x27;Register a new organization&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;The organization has been successfully registered.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Bad Request - Invalid input data.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Conflict - Email or phone number already exists.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Unprocessable Entity - Phone number is required.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Internal Server Error - Something went wrong.&#x27;})<br />@Post(&#x27;register/organization&#x27;)<br /></code>
                </td>
            </tr>

                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="215"
                                    class="link-to-prism">src/modules/auth/auth.controller.ts:215</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Register a new client</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>createAuthOrganizationDto</td>
                                            <td>
                                                            <code><a href="../classes/CreateAuthOrganizationDto.html" target="_self" >CreateAuthOrganizationDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: Response</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>req</td>
                                            <td>
                                                        <code>Request</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>ip</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>: Response</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="resetPassword"></a>
                    <span class="name">
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier"></span>
                            <span class="modifier">Async</span>
                        <span ><b>resetPassword</b></span>
                        <a href="#resetPassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>resetPassword(resetPasswordDto: <a href="../classes/ResetPasswordDto.html" target="_self">ResetPasswordDto</a>, res: Response, req: Request, ip: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>

            <tr>
                <td class="col-md-4">
                    <b>Decorators : </b>
                    <br />
                    <code>@ApiOperation({summary: &#x27;Reset or init password&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Password successfully reset or initialized.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Bad Request - Invalid token or invalid input data.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Unauthorized - Invalid or expired token.&#x27;})<br />@ApiResponse({status: undefined, description: &#x27;Internal Server Error - Something went wrong.&#x27;})<br />@Put(&#x27;reset-password&#x27;)<br /></code>
                </td>
            </tr>

                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="832"
                                    class="link-to-prism">src/modules/auth/auth.controller.ts:832</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Reset or init password</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>resetPasswordDto</td>
                                            <td>
                                                            <code><a href="../classes/ResetPasswordDto.html" target="_self" >ResetPasswordDto</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: ResetPasswordDto</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>res</td>
                                            <td>
                                                        <code>Response</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <p>: Response</p>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>req</td>
                                            <td>
                                                        <code>Request</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                        <tr>
                                                <td>ip</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>: Response</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
	Body,
	Controller,
	Get,
	HttpStatus,
	Ip,
	Param,
	Post,
	Put,
	Req,
	Res,
} from &quot;@nestjs/common&quot;;
import { UsersService } from &quot;@modules/users/users.service&quot;;
import { ClientsService } from &quot;@modules/clients/clients.service&quot;;
import { ApiOperation, ApiResponse, ApiTags } from &quot;@nestjs/swagger&quot;;
import { Responses } from &quot;@helpers/responses.helper&quot;;
import { CreateAuthClientDto } from &quot;@modules/auth/dto/create-auth-client.dto&quot;;
import { CreateAuthOrganizationDto } from &quot;@modules/auth/dto/create-auth-organization.dto&quot;;
import { Response } from &quot;express&quot;;
import { NotificationHelper } from &quot;@helpers/notification.helper&quot;;
import Hash from &quot;@helpers/hash.helper&quot;;
import { Token } from &quot;@helpers/token.helper&quot;;
import { UserStatusEnum } from &quot;@enums/user-status.enum&quot;;
import { MailHelper } from &quot;@src/providers/mail/helpers/mail.helper&quot;;
import { TokenTypeEnum } from &quot;@enums/token-type.enum&quot;;
import { LoginUserDto } from &quot;@modules/auth/dto/login-user.dto&quot;;
import { RefreshTokenDto } from &quot;./dto/refresh-token.dto&quot;;
import { ResetPasswordDto } from &quot;./dto/reset-password.dto&quot;;
import { ForgotPasswordDto } from &quot;./dto/forgot-password.dto&quot;;
import { LogLevelEnum } from &quot;@enums/log-level.enum&quot;;
import { LogHelper } from &quot;@helpers/log.helper&quot;;
import { OrganizationsService } from &quot;@modules/organizations/organizations.service&quot;;
import { BookerEmployeesService } from &quot;@modules/booker-employees/booker-employees.service&quot;;
import { UserRoleEnum } from &quot;@enums/user-role.enum&quot;;
import { StringHelper } from &quot;@helpers/string.helper&quot;;

@ApiTags(&quot;auth&quot;)
@Controller(&quot;auth&quot;)
export class AuthController {
	constructor(
		private readonly userService: UsersService,
		private readonly clientService: ClientsService,
		private readonly bookerEmployeesService: BookerEmployeesService,
		private readonly organizationsService: OrganizationsService,
		private readonly mailHelper: MailHelper,
		private readonly logHelper: LogHelper,
	) {}

	/**
	 * Register a new client
	 * @param createAuthClientDto : CreateAuthClientDto
	 * @param res : Response
	 * @returns : Response
	 */
	@ApiOperation({ summary: &quot;Register a new client&quot; })
	@ApiResponse({
		status: HttpStatus.CREATED,
		description: &quot;The client has been successfully registered.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.BAD_REQUEST,
		description: &quot;Bad Request - Invalid input data.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.CONFLICT,
		description: &quot;Conflict - Email or phone number already exists.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.UNPROCESSABLE_ENTITY,
		description: &quot;Unprocessable Entity - Phone number is required.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.INTERNAL_SERVER_ERROR,
		description: &quot;Internal Server Error - Something went wrong.&quot;,
	})
	@Post(&quot;register/client&quot;)
	async registerClient(
		@Body() createAuthClientDto: CreateAuthClientDto,
		@Res() res: Response,
		@Req() req: Request,
		@Ip() ip: string,
	) {
		const path &#x3D; &quot;register&quot;;
		const method &#x3D; &quot;Post&quot;;

		try {
			// Check if phone number is required
			NotificationHelper.isPhoneRequired(
				createAuthClientDto.phone,
				createAuthClientDto.notificationSms,
			);

			// Hash password
			createAuthClientDto.password &#x3D; await Hash.hashData(
				createAuthClientDto.password,
			);

			// Create user and client
			let user &#x3D; await this.userService.create(createAuthClientDto);
			const client &#x3D; await this.clientService.create({
				...createAuthClientDto,
				userId: user?._id?.toString(),
			});

			user &#x3D; await this.userService.findOne(user?._id?.toString());

			// Generate token for email confirmation
			const payload &#x3D; { sub: user._id, email: user.email };

			const token &#x3D; Token.generateToken(payload);

			// Email confirmation for the client
			await this.mailHelper.sendConfirmAccountClient({
				to: [user.email],
				templateDatas: {
					firstName: client.firstName,
					token: token,
				},
			});

			// Log the registration
			this.logHelper.log({
				ip,
				user: req[&quot;user&quot;],
				userInfos: req[&quot;userInfos&quot;],
				level: LogLevelEnum.INFO,
				message: &quot;Client successfully registered&quot;,
				context: &#x60;AuthController &gt; ${path}: &#x60;,
			});

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.CREATED,
				subject: &quot;auth&quot;,
				data: {
					user,
					client,
				},
			});
		} catch (error) {
			console.error(&#x60;AuthController &gt; ${path} : &#x60;, error);

			if (
				error.message.includes(&quot;E11000 duplicate key error collection&quot;)
			) {
				let errorMessage &#x3D; &quot;An account already exists&quot;;

				if (error.message.includes(&quot;email_1&quot;)) {
					errorMessage &#x3D; &quot;An account with this email already exists&quot;;
				} else if (error.message.includes(&quot;phone_1&quot;)) {
					errorMessage &#x3D;
						&quot;An account with this phone number already exists&quot;;
				}

				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.CONFLICT,
					subject: &quot;auth&quot;,
					error: errorMessage,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;Phone number is required&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.UNPROCESSABLE_ENTITY,
					subject: &quot;auth&quot;,
					error: &quot;Phone number is required&quot;,
				});
			}

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.INTERNAL_SERVER_ERROR,
				subject: &quot;auth&quot;,
				error: &quot;An error occurred while creating the account&quot;,
			});
		}
	}

	/**
	 * Register a new client
	 * @param createAuthClientDto : CreateAuthClientDto
	 * @param res : Response
	 * @returns : Response
	 */
	@ApiOperation({ summary: &quot;Register a new organization&quot; })
	@ApiResponse({
		status: HttpStatus.CREATED,
		description: &quot;The organization has been successfully registered.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.BAD_REQUEST,
		description: &quot;Bad Request - Invalid input data.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.CONFLICT,
		description: &quot;Conflict - Email or phone number already exists.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.UNPROCESSABLE_ENTITY,
		description: &quot;Unprocessable Entity - Phone number is required.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.INTERNAL_SERVER_ERROR,
		description: &quot;Internal Server Error - Something went wrong.&quot;,
	})
	@Post(&quot;register/organization&quot;)
	async registerOrganization(
		@Body() createAuthOrganizationDto: CreateAuthOrganizationDto,
		@Res() res: Response,
		@Req() req: Request,
		@Ip() ip: string,
	) {
		const path &#x3D; &quot;registerOrganization&quot;;
		const method &#x3D; &quot;Post&quot;;

		try {
			// Create organization
			const organization &#x3D; await this.organizationsService.create(createAuthOrganizationDto.organization);

			if (!organization) {
				throw new Error(&quot;Organization could not be created&quot;);
			}

			createAuthOrganizationDto.user.role &#x3D;
				UserRoleEnum.ORGANIZATION_SUPER_ADMIN;
			createAuthOrganizationDto.user.password &#x3D;
				StringHelper.generatePassword();

			// Create user
			const user &#x3D; await this.userService.create(
				createAuthOrganizationDto.user
			);

			if (!user) {
				organization.deleteOne();
				throw new Error(&quot;User could not be created&quot;);
			}

			// Create booker employee
			const bookerEmployee &#x3D; await this.bookerEmployeesService.create(createAuthOrganizationDto.bookerEmployee);

			if (!bookerEmployee) {
				organization.deleteOne();
				user.deleteOne();
				throw new Error(&quot;Booker employee could not be created&quot;);
			}

			// user &#x3D; await this.userService.findOne(user?._id?.toString());

			// Generate token for email confirmation
			const payload &#x3D; { sub: user._id, email: user.email };

			const token &#x3D; Token.generateToken(payload);

			// Email confirmation for the organization
			await this.mailHelper.sendConfirmAccountOrganization({
				to: [user.email],
				templateDatas: {
					organizationName: organization.name,
					userEmail: user.email,
					token: token,
				},
			});

			// Email mot de passe for the organization
			await this.mailHelper.sendInitPasswordEmail({
				to: [user.email],
				templateDatas: {
					token: token,
				},
			});

			// Log the registration
			this.logHelper.log({
				ip,
				user: req[&quot;user&quot;],
				userInfos: req[&quot;userInfos&quot;],
				level: LogLevelEnum.INFO,
				message: &quot;Organization successfully registered&quot;,
				context: &#x60;AuthController &gt; ${path}: &#x60;,
			});

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.CREATED,
				subject: &quot;auth&quot;,
				data: {
					user,
					organization,
				},
			});
		} catch (error) {
			console.error(&#x60;AuthController &gt; ${path} : &#x60;, error);

			if (
				error.message.includes(&quot;E11000 duplicate key error collection&quot;)
			) {
				let errorMessage &#x3D; &quot;An account already exists&quot;;

				if (error.message.includes(&quot;email_1&quot;)) {
					errorMessage &#x3D; &quot;An account with this email already exists&quot;;
				} else if (error.message.includes(&quot;phone_1&quot;)) {
					errorMessage &#x3D;
						&quot;An account with this phone number already exists&quot;;
				}

				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.CONFLICT,
					subject: &quot;auth&quot;,
					error: errorMessage,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;Phone number is required&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.UNPROCESSABLE_ENTITY,
					subject: &quot;auth&quot;,
					error: &quot;Phone number is required&quot;,
				});
			}

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.INTERNAL_SERVER_ERROR,
				subject: &quot;auth&quot;,
				error: &quot;An error occurred while creating the account&quot;,
			});
		}
	}

	/**
	 * Sign in an user
	 * @param loginUserDto : LoginUserDto
	 * @param res : Response
	 * @returns : Response
	 */
	@ApiOperation({ summary: &quot;Sign in an user&quot; })
	@ApiResponse({
		status: HttpStatus.OK,
		description: &quot;The user has been successfully authenticated.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.BAD_REQUEST,
		description: &quot;Bad Request - Invalid input data.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.NOT_FOUND,
		description: &quot;Not Found - User not found.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.INTERNAL_SERVER_ERROR,
		description: &quot;Internal Server Error - Something went wrong.&quot;,
	})
	@Post(&quot;login&quot;)
	async login(
		@Body() loginUserDto: LoginUserDto,
		@Res() res: Response,
		@Req() req: Request,
		@Ip() ip: string,
	) {
		const path &#x3D; &quot;login&quot;;
		const method &#x3D; &quot;Post&quot;;

		try {
			// Find user
			const user &#x3D; await this.userService.findWhere({
				where: {
					email: loginUserDto.email,
				},
				find: &quot;+password&quot;,
			});

			if (!user || user.length &#x3D;&#x3D;&#x3D; 0) {
				throw new Error(&quot;User not found&quot;);
			}

			// Compare password
			const comparePassword &#x3D; await Hash.hashCompareData(
				loginUserDto.password,
				user[0].password,
			);

			if (!comparePassword) {
				throw new Error(&quot;Invalid credentials&quot;);
			}

			// Find client
			const client &#x3D; await this.clientService.findWhere({
				where: {
					userId: user[0]._id.toString(),
				},
			});

			if (!client || client.length &#x3D;&#x3D;&#x3D; 0) {
				throw new Error(&quot;Client not found&quot;);
			}

			// Check user status
			if (user[0].status.includes(UserStatusEnum.NOT_VERIFIED)) {
				const payload &#x3D; {
					sub: user[0]._id,
					email: user[0].email,
					type: TokenTypeEnum.CONFIRMATION_ACCOUNT,
				};
				const tokenConfirmation &#x3D; Token.generateToken(payload);

				await this.mailHelper.sendConfirmAccountClient({
					to: [user[0].email],
					templateDatas: {
						firstName: client[0].firstName,
						token: tokenConfirmation,
					},
				});

				throw new Error(&quot;Invalid token&quot;);
			}

			if (
				user[0].status.some((status) &#x3D;&gt;
					[UserStatusEnum.BANNED, UserStatusEnum.SUSPENDED].includes(
						status,
					),
				)
			) {
				throw new Error(&quot;User suspended or banned&quot;);
			}

			// Generate tokens
			const payload_token &#x3D; { sub: user[0]._id, email: user[0].email };

			const accessToken &#x3D; Token.generateAccessToken({
				...payload_token,
				type: TokenTypeEnum.ACCESS,
			});
			const refreshToken &#x3D; Token.generateRefreshToken({
				...payload_token,
				type: TokenTypeEnum.REFRESH,
			});

			// Log the login
			this.logHelper.log({
				ip: ip,
				user: req[&quot;user&quot;],
				userInfos: req[&quot;userInfos&quot;],
				level: LogLevelEnum.INFO,
				message: &quot;User successfully registered&quot;,
				context: &#x60;AuthController &gt; ${path}: &#x60;,
				metadata: { user, client },
			});

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.OK,
				subject: &quot;auth&quot;,
				data: {
					access_token: accessToken,
					refresh_token: refreshToken,
				},
			});
		} catch (error) {
			console.error(&#x60;AuthController &gt; ${path} : &#x60;, error);

			if (error.message &#x3D;&#x3D;&#x3D; &quot;User not found&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.NOT_FOUND,
					subject: &quot;auth&quot;,
					error: &quot;User not found&quot;,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;Invalid credentials&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.UNAUTHORIZED,
					subject: &quot;auth&quot;,
					error: &quot;Invalid credentials&quot;,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;User suspended or banned&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.FORBIDDEN,
					subject: &quot;auth&quot;,
					error: &quot;User suspended or banned&quot;,
				});
			}

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.INTERNAL_SERVER_ERROR,
				subject: &quot;auth&quot;,
				error: &quot;An error occurred while logging in&quot;,
			});
		}
	}

	/**
	 * Confirm user account
	 * @param token : string
	 * @param res : Response
	 * @returns : Response
	 */
	@ApiOperation({ summary: &quot;Confirm user account&quot; })
	@ApiResponse({
		status: HttpStatus.OK,
		description: &quot;The user account has been successfully verified.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.BAD_REQUEST,
		description: &quot;Bad Request - Invalid token.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.NOT_FOUND,
		description: &quot;Not Found - User not found.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.GONE,
		description: &quot;Gone - Token expired.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.INTERNAL_SERVER_ERROR,
		description: &quot;Internal Server Error - Something went wrong.&quot;,
	})
	@Get(&quot;confirm/:token&quot;)
	async confirm(
		@Param(&quot;token&quot;) token: string,
		@Res() res: Response,
		@Req() req: Request,
		@Ip() ip: string,
	) {
		const path &#x3D; &quot;confirm&quot;;
		const method &#x3D; &quot;Get&quot;;

		try {
			// Verify token
			const verifyToken &#x3D; Token.verifyToken(
				token,
				TokenTypeEnum.CONFIRMATION_ACCOUNT,
			);

			if (!verifyToken) {
				throw new Error(&quot;Invalid token&quot;);
			}

			// Get payload
			const payload &#x3D; Token.getPayload(token);

			if (!payload) {
				throw new Error(&quot;Invalid token&quot;);
			}

			// Find user
			const user &#x3D; await this.userService.findWhere({
				where: {
					_id: payload.sub.toString(),
					email: payload.email,
				},
			});

			if (!user || user.length &#x3D;&#x3D;&#x3D; 0) {
				throw new Error(&quot;User not found&quot;);
			}

			if (!user[0].status.includes(UserStatusEnum.NOT_VERIFIED)) {
				throw new Error(&quot;Invalid token&quot;);
			}

			// Find client
			const client &#x3D; await this.clientService.findWhere({
				where: {
					userId: user[0]._id.toString(),
				},
			});

			if (!client || client.length &#x3D;&#x3D;&#x3D; 0) {
				throw new Error(&quot;Client not found&quot;);
			}

			// Check if token is expired
			const isExpired &#x3D; Token.isTokenExpired(token);

			if (isExpired) {
				const newToken &#x3D; await Token.generateToken({
					id: user[0]._id,
					email: user[0].email,
				});

				// Email confirmation for the client
				await this.mailHelper.sendConfirmAccountClient({
					to: [user[0].email],
					templateDatas: {
						firstName: client[0].firstName,
						token: newToken,
					},
				});

				throw new Error(&quot;Token expired&quot;);
			}

			// Update user status
			await this.userService.update(user[0].id, {
				status: [UserStatusEnum.ACTIVE],
			});

			// Log the confirmation
			this.logHelper.log({
				ip: ip,
				user: req[&quot;user&quot;],
				userInfos: req[&quot;userInfos&quot;],
				level: LogLevelEnum.INFO,
				message: &quot;User successfully confirmed account&quot;,
				context: &#x60;AuthController &gt; ${path}: &#x60;,
				metadata: { user, client },
			});

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.NO_CONTENT,
				subject: &quot;auth&quot;,
				data: {},
			});
		} catch (error) {
			console.error(&#x60;AuthController &gt; ${path} : &#x60;, error);

			if (
				error.message &#x3D;&#x3D;&#x3D; &quot;User not found&quot; ||
				error.message &#x3D;&#x3D;&#x3D; &quot;Client not found&quot;
			) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.NOT_FOUND,
					subject: &quot;auth&quot;,
					error: error.message,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;Invalid token&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.BAD_REQUEST,
					subject: &quot;auth&quot;,
					error: &quot;Invalid token&quot;,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;Token expired&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.GONE,
					subject: &quot;auth&quot;,
					error: &quot;Token expired&quot;,
				});
			}

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.INTERNAL_SERVER_ERROR,
				subject: &quot;auth&quot;,
				error: &quot;An error occurred while confirming the account&quot;,
			});
		}
	}

	/**
	 * Regenerate access token using refresh token
	 * @param refreshTokenDto : RefreshTokenDto
	 * @param res : Response
	 * @returns : Response
	 */
	@ApiOperation({ summary: &quot;Regenerate access token using refresh token&quot; })
	@ApiResponse({
		status: HttpStatus.OK,
		description: &quot;Access token successfully regenerated.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.BAD_REQUEST,
		description: &quot;Bad Request - Invalid refresh token.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.UNAUTHORIZED,
		description: &quot;Unauthorized - Refresh token is expired or invalid.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.INTERNAL_SERVER_ERROR,
		description: &quot;Internal Server Error - Something went wrong.&quot;,
	})
	@Post(&quot;refresh-token&quot;)
	async refreshToken(
		@Body() refreshTokenDto: RefreshTokenDto,
		@Res() res: Response,
	) {
		const { refreshToken } &#x3D; refreshTokenDto;
		const path &#x3D; &quot;refresh-token&quot;;
		const method &#x3D; &quot;Post&quot;;

		try {
			// Verify token
			const decoded &#x3D; Token.verifyToken(
				refreshToken,
				TokenTypeEnum.REFRESH,
			);

			if (!decoded) {
				throw new Error(&quot;Invalid token&quot;);
			}

			// Find user
			const user &#x3D; await this.userService.findOne(decoded.sub.toString());

			if (!user) {
				throw new Error(&quot;User not found&quot;);
			}

			// Check if token is expired
			const isExpired &#x3D; Token.isTokenExpired(refreshToken);

			if (isExpired) {
				throw new Error(&quot;Invalid or expired refresh token&quot;);
			}

			// Generate new access token
			const newAccessToken &#x3D; Token.generateAccessToken({
				sub: user._id,
				email: user.email,
			});

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.OK,
				subject: &quot;auth&quot;,
				data: { access_token: newAccessToken },
			});
		} catch (error) {
			console.error(&#x60;AuthController &gt; ${path} : &#x60;, error);

			if (error.message &#x3D;&#x3D;&#x3D; &quot;User not found&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.BAD_REQUEST,
					subject: &quot;auth&quot;,
					error: &quot;User not found&quot;,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;Expired refresh token&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.UNAUTHORIZED,
					subject: &quot;auth&quot;,
					error: &quot;Expired refresh token&quot;,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;Invalid token&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.BAD_REQUEST,
					subject: &quot;auth&quot;,
					error: &quot;Invalid token&quot;,
				});
			}

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.INTERNAL_SERVER_ERROR,
				subject: &quot;auth&quot;,
				error: &quot;An error occurred while confirming the account&quot;,
			});
		}
	}

	/**
	 * Reset or init password
	 * @param resetPasswordDto : ResetPasswordDto
	 * @param res : Response
	 * @returns : Response
	 */
	@ApiOperation({ summary: &quot;Reset or init password&quot; })
	@ApiResponse({
		status: HttpStatus.OK,
		description: &quot;Password successfully reset or initialized.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.BAD_REQUEST,
		description: &quot;Bad Request - Invalid token or invalid input data.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.UNAUTHORIZED,
		description: &quot;Unauthorized - Invalid or expired token.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.INTERNAL_SERVER_ERROR,
		description: &quot;Internal Server Error - Something went wrong.&quot;,
	})
	@Put(&quot;reset-password&quot;)
	async resetPassword(
		@Body() resetPasswordDto: ResetPasswordDto,
		@Res() res: Response,
		@Req() req: Request,
		@Ip() ip: string,
	) {
		const { token, newPassword } &#x3D; resetPasswordDto;
		const path &#x3D; &quot;reset-password&quot;;
		const method &#x3D; &quot;Post&quot;;

		try {
			// Verify token
			const decoded &#x3D; Token.verifyToken(token);

			if (!decoded) {
				throw new Error(&quot;Invalid token&quot;);
			}

			// Find user
			const user &#x3D; await this.userService.findOne(decoded.sub.toString());

			if (!user) {
				throw new Error(&quot;User not found&quot;);
			}

			// Hash password
			user.password &#x3D; await Hash.hashData(newPassword);

			// Update password
			const updatePassword &#x3D; await this.userService.update(
				user._id.toString(),
				{ password: user.password },
			);

			if (!updatePassword) {
				throw new Error(&quot;The password could not be updated&quot;);
			}

			// Log the password reset
			try {
				const client &#x3D; await this.clientService.findWhere({
					where: {
						userId: user[0]._id.toString(),
					},
				});

				if (!client || client.length &#x3D;&#x3D;&#x3D; 0) {
					throw new Error(&quot;Client not found&quot;);
				}

				this.logHelper.log({
					ip: ip,
					user: req[&quot;user&quot;],
					userInfos: req[&quot;userInfos&quot;],
					level: LogLevelEnum.INFO,
					message: &quot;User successfully registered&quot;,
					context: &#x60;AuthController &gt; ${path}: &#x60;,
					metadata: { user, client },
				});
			} catch (logError) {
				console.error(&#x60;Failed to create log in ${path}: &#x60;, logError);
			}

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.OK,
				subject: &quot;auth&quot;,
				data: { message: &quot;Password successfully reset or initialized&quot; },
			});
		} catch (error) {
			console.error(&#x60;AuthController &gt; ${path} : &#x60;, error);

			if (error.message &#x3D;&#x3D;&#x3D; &quot;User not found&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.UNAUTHORIZED,
					subject: &quot;auth&quot;,
					error: &quot;Invalid user associated with this token&quot;,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;Invalid token&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.BAD_REQUEST,
					subject: &quot;auth&quot;,
					error: &quot;Invalid token&quot;,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;The password could not be updated&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.INTERNAL_SERVER_ERROR,
					subject: &quot;auth&quot;,
					error: &quot;The password could not be updated&quot;,
				});
			}

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.INTERNAL_SERVER_ERROR,
				subject: &quot;auth&quot;,
				error: &quot;An error occurred while resetting the password&quot;,
			});
		}
	}

	/**
	 * Forgot Password
	 * @param forgotPasswordDto : ForgotPasswordDto
	 * @param res : Response
	 * @param ip : string
	 * @returns : Response
	 */
	@ApiOperation({ summary: &quot;Forgot Password&quot; })
	@ApiResponse({
		status: HttpStatus.OK,
		description: &quot;Password reset link sent to the user&#x27;s email.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.BAD_REQUEST,
		description: &quot;Bad Request - Invalid email provided.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.NOT_FOUND,
		description: &quot;Not Found - User with this email does not exist.&quot;,
	})
	@ApiResponse({
		status: HttpStatus.INTERNAL_SERVER_ERROR,
		description: &quot;Internal Server Error - Something went wrong.&quot;,
	})
	@Post(&quot;forgot-password&quot;)
	async forgotPassword(
		@Body() forgotPasswordDto: ForgotPasswordDto,
		@Res() res: Response,
		@Req() req: Request,
		@Ip() ip: string,
	) {
		const { email } &#x3D; forgotPasswordDto;
		const path &#x3D; &quot;forgot-password&quot;;
		const method &#x3D; &quot;Post&quot;;

		try {
			// Find user
			const user &#x3D; await this.userService.findWhere({
				where: { email },
				limit: 1,
			});

			// Check if user exists
			if (user) {
				const payload &#x3D; {
					sub: user[0]._id,
					email: user[0].email,
					type: TokenTypeEnum.RESET_PASSWORD,
				};
				const resetToken &#x3D; Token.generateToken(payload);

				// Send email
				const sendEmail &#x3D; await this.mailHelper.sendResetPasswordEmail({
					to: [user[0].email],
					templateDatas: {
						token: resetToken,
					},
				});

				if (!sendEmail) {
					throw new Error(&quot;Email could not be sent&quot;);
				}
			}

			// Log the password reset
			try {
				const client &#x3D; await this.clientService.findWhere({
					where: {
						userId: user[0]._id.toString(),
					},
				});

				if (!client || client.length &#x3D;&#x3D;&#x3D; 0) {
					throw new Error(&quot;Client not found&quot;);
				}

				this.logHelper.log({
					ip: ip,
					user: req[&quot;user&quot;],
					userInfos: req[&quot;userInfos&quot;],
					level: LogLevelEnum.INFO,
					message: &quot;User successfully registered&quot;,
					context: &#x60;AuthController &gt; ${path}: &#x60;,
					metadata: { user, client },
				});
			} catch (logError) {
				console.error(&#x60;Failed to create log in ${path}: &#x60;, logError);
			}

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.OK,
				subject: &quot;auth&quot;,
				data: {
					message:
						&quot;If this account exist, the password reset link sent to the user&#x27;s email&quot;,
				},
			});
		} catch (error) {
			console.error(&#x60;AuthController &gt; ${path} : &#x60;, error);

			if (
				error.message.includes(&quot;E11000 duplicate key error collection&quot;)
			) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.BAD_REQUEST,
					subject: &quot;auth&quot;,
					error: &quot;Duplicate key error&quot;,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;User not found&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.NOT_FOUND,
					subject: &quot;auth&quot;,
					error: &quot;User with this email does not exist&quot;,
				});
			} else if (error.message &#x3D;&#x3D;&#x3D; &quot;Email could not be sent&quot;) {
				return Responses.getResponse({
					res,
					path,
					method,
					code: HttpStatus.INTERNAL_SERVER_ERROR,
					subject: &quot;auth&quot;,
					error: &quot;Email could not be sent&quot;,
				});
			}

			return Responses.getResponse({
				res,
				path,
				method,
				code: HttpStatus.INTERNAL_SERVER_ERROR,
				subject: &quot;auth&quot;,
				error: &quot;An error occurred while processing your request&quot;,
			});
		}
	}
}
</code></pre>
    </div>
</div>
















                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'controller';
            var COMPODOC_CURRENT_PAGE_URL = 'AuthController.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
